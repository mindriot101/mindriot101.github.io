<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Kafka findings</title>

            <link href="https://mindriot101.github.io/feeds/all.xml" type="application/atom+xml" rel="alternate" title="circularspace Full Atom Feed" />
            <link href="https://mindriot101.github.io/feeds/tech.xml" type="application/atom+xml" rel="alternate" title="circularspace Categories Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="https://mindriot101.github.io/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://mindriot101.github.io/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://mindriot101.github.io/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="How does Kafka distribute its messages to consumers?">

        <meta name="author" content="Simon Walker">

        <meta name="tags" content="kafka">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="circularspace">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://mindriot101.github.io/author/simon-walker.html">
	<meta property="og:url" content="https://mindriot101.github.io/blog/2020/04/09/kafka-findings/">
	<meta property="og:title" content="Kafka findings">
	<meta property="article:published_time" content="2020-04-09 09:28:12+01:00">
            <meta property="og:description" content="How does Kafka distribute its messages to consumers?">

            <meta property="og:image" content="https://mindriot101.github.io/theme/images/post-bg.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@srwalker101">
        <meta name="twitter:title" content="Kafka findings">

            <meta name="twitter:image" content="https://mindriot101.github.io/theme/images/post-bg.jpg">

            <meta name="twitter:description" content="How does Kafka distribute its messages to consumers?">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://mindriot101.github.io/">circularspace</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                        <li><a href="/archives.html">all</a></li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-color: #444">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Kafka findings</h1>
                        <span class="meta">Posted by
                                <a href="https://mindriot101.github.io/author/simon-walker.html">Simon Walker</a>
                             on Thu 09 April 2020
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h1>Outline</h1>
<p>How does Kafka distribute its messages?</p>
<p>I wanted to use Kafka in two ways:</p>
<ol>
<li>to behave like a FIFO queue where work can be parallelised by spinning up multiple worker processes such that they consume messages once from the topic in a first-come first-served way, and</li>
<li>to split the work deterministically between workers.</li>
</ol>
<p>The second use case is where Kafka excels over other pub/sub messaging systems (e.g. AMQP) as messages can be assigned to partitions to ensure consistency, however for my greater understanding I wanted to know if Kafka could be used as a drop-in replacement for e.g. Rabbitmq.</p>
<h2>Experiment</h2>
<ul>
<li>Set up a Kafka broker (single one for now) and try to consume messages from a topic.</li>
<li>Play with the combination of partition number and group id to test the desired results.</li>
</ul>
<table>
<thead>
<tr>
<th>Partition #</th>
<th>Consumer #</th>
<th>Group ID distribution</th>
<th>Observations</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>-</td>
<td>All messages are delivered to the single consumer</td>
</tr>
<tr>
<td>1</td>
<td>N</td>
<td>same</td>
<td>All messages are delivered to a single consumer in that group</td>
</tr>
<tr>
<td>1</td>
<td>N</td>
<td>different</td>
<td>All messages are sent to <em>each</em> consumer</td>
</tr>
<tr>
<td>N</td>
<td>1</td>
<td>-</td>
<td>All messages are delivered to the single consumer</td>
</tr>
<tr>
<td>N</td>
<td>N</td>
<td>same</td>
<td>Messages are distributed between consumers</td>
</tr>
<tr>
<td>N</td>
<td>N</td>
<td>different</td>
<td>All messages are sent to <em>each</em> consumer</td>
</tr>
</tbody>
</table>
<h2>Message keys</h2>
<p>Messages can be assigned <em>keys</em> which ensure predictable routing. This is desired as Kafka guaruntees consistent ordering <em>within a partition</em>. If the use case relates to relationships between consistent sources of data and consistent ordering is required then a deterministic key should be assigned to each message.</p>
<p>For example given an event-sourced model of bank accounts, we model the changes to an account as a stream of information. In order to calculate the balance at any one point, a stream of changes ("deltas") must be summed. To do this accurately, the consumer that is aggregating the deltas must get all of the messages for that account. We can therefore give each message a key that relates to that bank account.</p>
<h1>Summary</h1>
<ol>
<li>For use case 1 (distributing messages evenly to a pool of consumers, distributing load):<ul>
<li>the topic must contain multiple partitions</li>
<li>each consumer must have a unique group id</li>
</ul>
</li>
<li>For use case 2 above:<ul>
<li>the topic must contain multiple partitions</li>
<li>each consumer must have a unique group id</li>
<li>message keys provide predictable routing</li>
</ul>
</li>
</ol>
<p>A helper environment can be found <a href="https://github.com/mindriot101/kafka-partition-testing-src.git">here</a> which sets up a Kafka environment with <code>docker-compose</code>.</p>
    </article>

        <div class="tags">
            <p>tags: <a href="https://mindriot101.github.io/tag/kafka.html">kafka</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/srwalker101">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/mindriot101">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="https://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="https://python.org">Python</a>. <br />        &copy;  Simon Walker
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://mindriot101.github.io/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://mindriot101.github.io/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://mindriot101.github.io/theme/js/clean-blog.min.js"></script>

</body>

</html>